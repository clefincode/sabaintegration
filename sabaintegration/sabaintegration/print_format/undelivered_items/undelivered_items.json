{
 "absolute_value": 0,
 "align_labels_right": 0,
 "creation": "2022-10-17 15:40:34.048861",
 "css": "",
 "custom_format": 1,
 "disabled": 0,
 "doc_type": "Delivery Note",
 "docstatus": 0,
 "doctype": "Print Format",
 "font": "Default",
 "html": "<h3>Undelivered Items</h3>\r\n{% if doc.packed_items %}\r\n<table border=1>\r\n{% for item in doc.items %}\r\n    {% if frappe.db.get_value(\"Item\", item.item_code, \"is_stock_item\") == 0 %}\r\n    <tr class=\"parent\" colspan=7 style=\"background-color: #6495ED\">\r\n        <th>{{item.item_code}}</th>\r\n    </tr>\r\n    {% if frappe.db.exists(\"Bundle Delivery Note\", {\r\n        'delivery_note': doc.name, 'docstatus': 1, 'item_parent':item.item_code}) %}\r\n        {% set sales_order = frappe.db.get_value(\"Bundle Delivery Note\", {\r\n            'delivery_note': doc.name, 'docstatus': 1}, \"sales_order\") %}\r\n        {% set packed_items_sales_order = frappe.db.get_all(\"Packed Item\", {\"parent\": sales_order, \"parent_item\": item.item_code}, [\"item_code\", \"qty\"]) %}\r\n        \r\n    {% set packed_items = frappe.db.get_all(\"Packed Item\", {'parent': doc.name, 'parent_item': item.item_code}, ['*']) %}\r\n    {% set ns1 = namespace(found = false) %}\r\n    {% for packed_item in packed_items if ns1.found == false %}\r\n        {% set ns2 = namespace(found = false) %}\r\n        {% for row in packed_items_sales_order  if ns2.found == false %}\r\n            {% if row.item_code == packed_item.item_code and qty != (row.qty | float) %}\r\n                {% set ns2.found = true %}\r\n                \r\n            {% endif %}\r\n        {% endfor %}\r\n        {%if ns2.found == true%}\r\n            {% set ns1.found = true %}\r\n        {% endif %}\r\n    {% endfor %}\r\n    {% if ns1.found == true %}\r\n        <tr class=\"heading\" style=\"background-color: #A9A9A9\">\r\n            <th>Item Code</th>\r\n            <th>Description</th>\r\n            <th>Quantity</th>\r\n        </tr>\r\n        {% set packed_items = frappe.db.get_all(\"Packed Item\", {'parent': doc.name, 'parent_item': item.item_code}, ['*']) %}\r\n        {% for packed_item in packed_items %}\r\n            {% set ns = namespace(found = false) %}\r\n            {% set ns_qty = namespace(total_qty = packed_item.qty) %}\r\n                {% for row in packed_items_sales_order  if ns.found == false %}\r\n                    {% if row.item_code == packed_item.item_code and packed_item.qty == (row.qty | float) %}\r\n                        {% set ns.found = true %}\r\n                    {% elif row.item_code == packed_item.item_code and packed_item.qty != (row.qty | float) %}\r\n                        {% set ns_qty.total_qty =  (row.qty | float) - packed_item.qty  %}\r\n                        {% set ns.found = true %}\r\n                    \r\n                    {% endif %}\r\n                {% endfor %}\r\n            {% if ns.found == false or (ns.found == true and frappe.db.get_value(\"Packed Item\", {\"parent\": sales_order, \"parent_item\": item.item_code, \"item_code\": packed_item.item_code}, \"qty\") > ns_qty.total_qty) %}\r\n            <tr>\r\n                <td>{{packed_item.item_code}}</td>\r\n                <td>{{packed_item.item_name}}</td>\r\n                <td>{{ns_qty.total_qty}}</td>\r\n            </tr>\r\n            {% endif %}\r\n        {% endfor %}\r\n    {% else %}\r\n        <tr class=\"parent\" colspan=7>\r\n            <td style=\"background-color: #fff;\">All items are delivered</td>\r\n        </tr>\r\n    {% endif %}\r\n    {% else %}\r\n        {% set product = frappe.get_doc('Product Bundle', item.item_code) %}\r\n        <tr class=\"heading\">\r\n            <th>Item Code</th>\r\n            <th>Description</th>\r\n            <th>Quantity</th>\r\n        </tr>\r\n        {% for p_item in product.items %}\r\n        {% set qty = (p_item.qty | float) * item.qty %}\r\n        <tr>\r\n            <td>{{p_item.item_code}}</td>\r\n            <td>{{p_item.description}}</td>\r\n            <td>{{qty}}</td>\r\n        </tr>\r\n        {% endfor %}\r\n    {% endif %}\r\n{% endif %}\r\n{% endfor %}\r\n</table>\r\n{% else %}\r\n    <div style=\"text-align: center;\">No Packed Items in the Delivery Note</div>\r\n{% endif %}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
 "idx": 0,
 "line_breaks": 0,
 "modified": "2022-10-19 15:43:24.093470",
 "modified_by": "Administrator",
 "module": "Sabaintegration",
 "name": "Undelivered Items",
 "owner": "Administrator",
 "print_format_builder": 1,
 "print_format_type": "Jinja",
 "raw_printing": 0,
 "show_section_headings": 0,
 "standard": "Yes"
}