{
 "absolute_value": 0,
 "align_labels_right": 0,
 "creation": "2022-10-26 10:53:50.941530",
 "custom_format": 1,
 "default_print_language": "en",
 "disabled": 0,
 "doc_type": "Delivery Note",
 "docstatus": 0,
 "doctype": "Print Format",
 "font": "Default",
 "html": "<div class=\"print-heading\"><h2>Delivery Note<br><small>{{doc.name}}</small></h2></div>\n\n<table border = 0>\n    <tr>\n        <td>\n            {% if doc.customer %}\n            <div style=\"\">Customer: {{doc.customer}}</div>\n            {% endif %}\n        </td>\n        <td>\n            {% if doc.posting_date %}\n            <div style=\"\">Date: {{doc.posting_date}}</div>\n            {% endif %}\n        </td>\n    </tr>\n    <tr>\n        <td>\n            {% if doc.project %}\n            <div style=\"\">Project: {{doc.project}}</div>\n            {% endif %}\n        </td>\n        <td></td>\n    </tr>\n</table>\n\n<!--Delivered Items-->\n<div style=\"text-align:center;\">\n    <h3>Delivered Items</h3>\n</div>\n\n{% if doc.packed_items%}\n<table border = 1>\n{% for item in doc.items %}\n    {% if frappe.db.exists(\"Product Bundle\", {\"new_item_code\" :item.item_code} ) %}\n    {% set rows = frappe.db.get_all(\"Packed Item\", {'parent': doc.name, 'parent_item': item.item_code}, ['*']) %}\n    {% if rows %}\n    <tr class=\"parent\"  style=\"background-color: #6495ED\">\n        <th colspan=\"7\">{{item.item_code}}</th>\n    </tr>\n    <tr class=\"heading\" style=\"background-color: #A9A9A9\">\n        <th>Item Code</th>\n        <th>Item Name</th>\n        <th>Warehouse</th>\n        <th>Quantity</th>\n        <th>Rate</th>\n        <th>Batch No</th>\n        <th>Serial No</th>\n    </tr>\n    {% for row in rows %}\n    {% if row.qty > 0 %}\n    <tr>\n        <td>{{row.item_code}}</td>\n        <td>{{row.item_name}}</td>\n        <td>{{row.warehouse}}</td>\n        <td>{{row.qty}}</td>\n        <td>{{row.rate}}</td>\n        <td>{{row.batch_no}}</td>\n        <td>{{row.serial_no}}</td>\n    </tr>\n    {% endif %}\n    {% endfor %}\n    {% endif %}\n    {% endif %}\n{% endfor %}\n</table>\n{% endif %}\n\n\n<!--Undelivered Items-->\n<div style=\"text-align:center;\"><h3>Undelivered Items</h3></div>\n\n{% if doc.packed_items %}\n<table border=1>\n{% for item in doc.items %}\n    {% if frappe.db.get_value(\"Item\", item.item_code, \"is_stock_item\") == 0 %}\n    <tr class=\"parent\"  style=\"background-color: #6495ED\">\n        <th colspan=\"3\">{{item.item_code}}</th>\n    </tr>\n    {% if frappe.db.exists(\"Bundle Delivery Note\", {\n        'delivery_note': doc.name, 'docstatus': 1, 'item_parent':item.item_code}) %}\n        {% set sales_order = frappe.db.get_value(\"Bundle Delivery Note\", {\n            'delivery_note': doc.name, 'docstatus': 1}, \"sales_order\") %}\n        {% set packed_items_sales_order = frappe.db.get_all(\"Packed Item\", {\"parent\": sales_order, \"parent_item\": item.item_code}, [\"item_code\", \"qty\"]) %}\n        \n    {% set packed_items = frappe.db.get_all(\"Packed Item\", {'parent': doc.name, 'parent_item': item.item_code}, ['*']) %}\n    {% set ns1 = namespace(found = false) %}\n    {% for packed_item in packed_items if ns1.found == false %}\n        {% set ns2 = namespace(found = false) %}\n        {% for row in packed_items_sales_order  if ns2.found == false %}\n            {% if row.item_code == packed_item.item_code and qty != (row.qty | float) %}\n                {% set ns2.found = true %}\n                \n            {% endif %}\n        {% endfor %}\n        {%if ns2.found == true%}\n            {% set ns1.found = true %}\n        {% endif %}\n    {% endfor %}\n    {% if ns1.found == true %}\n        <tr class=\"heading\" style=\"background-color: #A9A9A9\">\n            <th>Item Code</th>\n            <th>Description</th>\n            <th>Quantity</th>\n        </tr>\n        {% set packed_items = frappe.db.get_all(\"Packed Item\", {'parent': doc.name, 'parent_item': item.item_code}, ['*']) %}\n        {% for packed_item in packed_items %}\n            {% set ns = namespace(found = false) %}\n            {% set ns_qty = namespace(total_qty = packed_item.qty) %}\n                {% for row in packed_items_sales_order  if ns.found == false %}\n                    {% if row.item_code == packed_item.item_code and packed_item.qty == (row.qty | float) %}\n                        {% set ns.found = true %}\n                    {% elif row.item_code == packed_item.item_code and packed_item.qty != (row.qty | float) %}\n                        {% set ns_qty.total_qty =  (row.qty | float) - packed_item.qty  %}\n                        {% set ns.found = true %}\n                    \n                    {% endif %}\n                {% endfor %}\n            {% if ns.found == false or (ns.found == true and frappe.db.get_value(\"Packed Item\", {\"parent\": sales_order, \"parent_item\": item.item_code, \"item_code\": packed_item.item_code}, \"qty\") > ns_qty.total_qty) %}\n            <tr>\n                <td>{{packed_item.item_code}}</td>\n                <td>{{packed_item.item_name}}</td>\n                <td>{{ns_qty.total_qty}}</td>\n            </tr>\n            {% endif %}\n        {% endfor %}\n    {% else %}\n        <tr class=\"parent\" >\n            <td colspan=\"3\" style=\"background-color: #fff;\">All items are delivered</td>\n        </tr>\n    {% endif %}\n    {% else %}\n        {% set product = frappe.get_doc('Product Bundle', item.item_code) %}\n        <tr class=\"heading\" style=\"background-color: #A9A9A9\">\n            <th>Item Code</th>\n            <th>Description</th>\n            <th>Quantity</th>\n        </tr>\n        {% for p_item in product.items %}\n        {% set qty = (p_item.qty | float) * item.qty %}\n        <tr>\n            <td>{{p_item.item_code}}</td>\n            <td>{{p_item.description}}</td>\n            <td>{{qty}}</td>\n        </tr>\n        {% endfor %}\n    {% endif %}\n{% endif %}\n{% endfor %}\n</table>\n{% else %}\n    <div style=\"text-align: center;\">No Packed Items in the Delivery Note</div>\n{% endif %}\n\n\n\n\n\n\n\n",
 "idx": 0,
 "line_breaks": 0,
 "modified": "2022-10-26 12:54:57.248948",
 "modified_by": "Administrator",
 "module": "Sabaintegration",
 "name": "Delivered and Undelivered Items",
 "owner": "Administrator",
 "print_format_builder": 0,
 "print_format_type": "Jinja",
 "raw_printing": 0,
 "show_section_headings": 0,
 "standard": "Yes"
}